<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å°æ —å¸½çš„ç¾å‘³æŒ‘æˆ°ï¼</title>
    <style>
        /* --- éŠæˆ²æ¨£å¼è¨­å®š --- */
        :root {
            --primary-color: #70a1ff;
            --bg-color: #f0f8ff;
            --board-bg: #ffffff;
            --timer-color: #ff4757;
        }

        body {
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg-color);
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            overflow: hidden;
            user-select: none; /* é˜²æ­¢é¸å–æ–‡å­— */
        }

        #game-container {
            position: relative;
            width: 100%;
            max-width: 480px; /* æ‰‹æ©Ÿç‰ˆå‹ */
            height: 100%;
            max-height: 800px;
            background-color: var(--board-bg);
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* é ‚éƒ¨è³‡è¨Šåˆ— */
        #top-bar {
            padding: 15px;
            display: flex;
            justify-content: space-between;
            font-size: 1.2rem;
            font-weight: bold;
            background: rgba(255,255,255,0.9);
            z-index: 10;
        }
        .score-box { color: #2ed573; }
        .time-box { color: var(--timer-color); }

        /* éŠæˆ²ä¸»ç•«é¢ (å°æ —å¸½å€åŸŸ) */
        #main-area {
            flex: 1;
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
            background-image: radial-gradient(#e0e0e0 10%, transparent 10%);
            background-size: 20px 20px;
        }

        /* å°æ —å¸½æœ¬é«” (ç¾åœ¨æ˜¯ div åŒ…è£¹ img) */
        #oguri-character {
            position: relative;
            transition: transform 0.2s;
            cursor: pointer;
            /* ç°¡å–®çš„å‘¼å¸å‹•ç•« */
            animation: breathe 2s infinite ease-in-out;
            display: flex; /* è®“åœ–ç‰‡èƒ½ç½®ä¸­ */
            justify-content: center;
            align-items: center;
        }

        #oguri-character img {
            max-width: 100%; /* ç¢ºä¿åœ–ç‰‡ä¸è¶…å‡ºå®¹å™¨ */
            height: auto;
            display: block; /* ç§»é™¤åœ–ç‰‡åº•éƒ¨å¤šé¤˜ç©ºé–“ */
            transition: all 0.2s ease-out; /* è®“è¡¨æƒ…è®ŠåŒ–æ›´å¹³æ»‘ */
        }

        @keyframes breathe {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.02); }
        }

        /* æ€è€ƒæ°£æ³¡ (å¥¹æƒ³åƒçš„æ±è¥¿) */
        #thought-bubble {
            position: absolute;
            top: -20px; /* ç›¸å°æ–¼ #oguri-character çš„ä½ç½® */
            right: -20px;
            background: white;
            border: 3px solid #333;
            border-radius: 50%;
            width: 80px;
            height: 80px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 3rem;
            box-shadow: 3px 3px 0px rgba(0,0,0,0.2);
            opacity: 0;
            transform: scale(0);
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        #thought-bubble.show {
            opacity: 1;
            transform: scale(1);
            top: 20px; /* æœ€çµ‚ä½ç½® */
            right: 20px;
        }

        /* è¡¨æƒ…è®ŠåŒ– CSS Class (æ‡‰ç”¨åœ¨ #oguri-character ä¸Š) */
        #oguri-character.happy img { filter: drop-shadow(0 0 15px gold) brightness(1.1); transform: scale(1.05); }
        #oguri-character.sad img { filter: grayscale(0.8) brightness(0.8); transform: scale(0.95); }

        /* åº•éƒ¨é£Ÿç‰©é¸æ“‡å€ */
        #food-tray {
            background: #fff;
            padding: 20px;
            border-top: 2px solid #eee;
            display: grid;
            grid-template-columns: repeat(4, 1fr); /* 4æ¬„ */
            gap: 10px;
            height: 120px;
        }

        .food-btn {
            background: #f1f2f6;
            border: none;
            border-radius: 15px;
            font-size: 2.5rem;
            cursor: pointer;
            transition: transform 0.1s, background 0.2s;
            display: flex;
            justify-content: center;
            align-items: center;
            box-shadow: 0 4px 0 #dfe4ea;
        }

        .food-btn:active {
            transform: translateY(4px);
            box-shadow: 0 0 0 #dfe4ea;
        }

        /* é€£æ“Šæ–‡å­—ç‰¹æ•ˆ */
        #combo-text {
            position: absolute;
            top: 40%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 3rem;
            font-weight: 900;
            color: #ffbf00;
            text-shadow: 2px 2px 0 #fff, -2px -2px 0 #fff, 2px -2px 0 #fff, -2px 2px 0 #fff;
            pointer-events: none;
            opacity: 0;
            z-index: 20;
        }
        @keyframes popUp {
            0% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; }
            50% { transform: translate(-50%, -80%) scale(1.5); opacity: 1; }
            100% { transform: translate(-50%, -100%) scale(1); opacity: 0; }
        }

        /* è¦†è“‹å±¤ (é–‹å§‹/çµæŸç•«é¢) */
        .overlay {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
            z-index: 100;
            text-align: center;
        }
        .overlay h1 { font-size: 2.5rem; margin-bottom: 10px; color: #ff9ff3; text-shadow: 2px 2px #000; }
        .overlay p { font-size: 1.2rem; margin-bottom: 30px; color: #ddd; }
        .btn-start {
            padding: 15px 40px;
            font-size: 1.5rem;
            background: #ff6b81;
            color: white;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            font-weight: bold;
            box-shadow: 0 5px 0 #c44569;
            transition: transform 0.1s;
        }
        .btn-start:active { transform: translateY(5px); box-shadow: none; }
        
        .hidden { display: none !important; }

    </style>
</head>
<body>

    <div id="game-container">
        
        <div id="top-bar">
            <div class="time-box">æ™‚é–“: <span id="timer">60</span></div>
            <div class="score-box">åˆ†æ•¸: <span id="score">0</span></div>
        </div>

        <div id="main-area">
            <div id="oguri-character">
                <img src="oguri_normal.png" id="oguri-img" alt="å°æ —å¸½" style="width: 250px; height: auto;">
                <div id="thought-bubble">ğŸ¥•</div>
            </div>
            
            <div id="combo-text">Combo!</div>
        </div>

        <div id="food-tray">
            </div>

        <div id="start-screen" class="overlay">
            <h1>å°æ —å¸½çš„<br>ç¾å‘³æŒ‘æˆ°</h1>
            <p>çœ‹æº–æ°£æ³¡è£¡çš„é£Ÿç‰©ï¼Œé»æ“Šä¸‹æ–¹å°æ‡‰æŒ‰éˆ•ï¼<br>ä¸è¦è®“å°æ —å¸½é¤“è‚šå­ï¼</p>
            <button class="btn-start" onclick="game.start()">é–‹å§‹é¤µé£Ÿï¼</button>
        </div>

        <div id="game-over-screen" class="overlay hidden">
            <h1>éŠæˆ²çµæŸ</h1>
            <p>æœ€çµ‚å¾—åˆ†: <span id="final-score">0</span></p>
            <p id="comment">è©•èªè¼‰å…¥ä¸­...</p>
            <button class="btn-start" onclick="game.start()">å†ä¾†ä¸€ç¢—ï¼</button>
        </div>

    </div>

    <script>
        // --- éŠæˆ²è¨­å®šèˆ‡è³‡æ–™ ---
        const FOOD_ITEMS = [
            { id: 'carrot', icon: 'ğŸ¥•', name: 'èƒ¡è˜¿è””' },
            { id: 'donut', icon: 'ğŸ©', name: 'ç”œç”œåœˆ' },
            { id: 'onigiri', icon: 'ğŸ™', name: 'é£¯ç³°' },
            { id: 'pudding', icon: 'ğŸ®', name: 'å¸ƒä¸' },
            { id: 'burger', icon: 'ğŸ”', name: 'æ¼¢å ¡' },
            { id: 'cake', icon: 'ğŸ°', name: 'è›‹ç³•' },
            { id: 'icecream', icon: 'ğŸ¦', name: 'å†°æ·‡æ·‹' },
            { id: 'apple', icon: 'ğŸ', name: 'è˜‹æœ' }
        ];

        // --- éŠæˆ²é‚è¼¯æ ¸å¿ƒ ---
        const game = {
            timeLimit: 60,
            timeLeft: 60,
            score: 0,
            combo: 0,
            isPlaying: false,
            timerInterval: null,
            currentRequest: null,
            
            // DOM å…ƒç´ å¿«å–
            elements: {
                oguri: document.getElementById('oguri-character'),
                oguriImg: document.getElementById('oguri-img'), // æ–°å¢é€™ä¸€è¡Œ
                bubble: document.getElementById('thought-bubble'),
                tray: document.getElementById('food-tray'),
                timerDisplay: document.getElementById('timer'),
                scoreDisplay: document.getElementById('score'),
                comboText: document.getElementById('combo-text'),
                startScreen: document.getElementById('start-screen'),
                gameOverScreen: document.getElementById('game-over-screen'),
                finalScore: document.getElementById('final-score'),
                comment: document.getElementById('comment')
            },

            // åˆå§‹åŒ–
            init: function() {
                this.renderTray();
            },

            // æ¸²æŸ“åº•éƒ¨æŒ‰éˆ•
            renderTray: function() {
                this.elements.tray.innerHTML = '';
                const shuffledFoods = [...FOOD_ITEMS].sort(() => 0.5 - Math.random()).slice(0, 4);
                
                shuffledFoods.forEach(food => {
                    const btn = document.createElement('button');
                    btn.className = 'food-btn';
                    btn.innerHTML = food.icon; // æ³¨æ„é€™è£¡ç”¨ innerHTML å› ç‚º icon å¯èƒ½æœ‰ img æ¨™ç±¤
                    btn.onclick = () => this.feed(food);
                    this.elements.tray.appendChild(btn);
                });
                
                this.activeFoods = shuffledFoods;
            },

            // é–‹å§‹éŠæˆ²
            start: function() {
                this.score = 0;
                this.timeLeft = this.timeLimit;
                this.combo = 0;
                this.isPlaying = true;
                
                this.elements.startScreen.classList.add('hidden');
                this.elements.gameOverScreen.classList.add('hidden');
                this.updateUI();
                
                this.renderTray();
                
                this.newRequest();
                
                clearInterval(this.timerInterval);
                this.timerInterval = setInterval(() => {
                    this.timeLeft--;
                    this.updateUI();
                    if (this.timeLeft <= 0) {
                        this.end();
                    }
                }, 1000);
            },

            // ç”¢ç”Ÿæ–°çš„æƒ³åƒé£Ÿç‰©
            newRequest: function() {
                if (!this.isPlaying) return;
                
                const randomIndex = Math.floor(Math.random() * this.activeFoods.length);
                this.currentRequest = this.activeFoods[randomIndex];
                
                this.elements.bubble.innerHTML = this.currentRequest.icon; // æ³¨æ„é€™è£¡ç”¨ innerHTML
                this.elements.bubble.classList.remove('show');
                
                setTimeout(() => {
                    this.elements.bubble.classList.add('show');
                    // æ¢å¾©æ­£å¸¸è¡¨æƒ…ï¼Œä½†å¦‚æœæ²’æœ‰å…¶ä»–åœ–ç‰‡ï¼Œå°±ä¸éœ€è¦æ”¹è®Š src
                    this.elements.oguri.classList.remove('happy', 'sad'); 
                    this.elements.oguriImg.src = 'oguri_normal.png'; // ç¢ºä¿æ¢å¾©é è¨­åœ–ç‰‡
                }, 100);
            },

            // ç©å®¶é¤µé£Ÿå‹•ä½œ
            feed: function(food) {
                if (!this.isPlaying) return;

                if (food.id === this.currentRequest.id) {
                    // ç­”å°äº†
                    this.combo++;
                    const points = 10 + (Math.min(this.combo, 10) * 2);
                    this.score += points;
                    
                    this.showComboAnim();
                    this.oguriReact('happy');
                    this.newRequest();
                } else {
                    // ç­”éŒ¯äº†
                    this.combo = 0;
                    this.oguriReact('sad');
                    this.timeLeft = Math.max(0, this.timeLeft - 2);
                }
                this.updateUI();
            },

            // å°æ —å¸½åæ‡‰å‹•ç•«
            oguriReact: function(mood) {
                const img = this.elements.oguriImg;
                const oguriContainer = this.elements.oguri;

                // æ¸…é™¤æ‰€æœ‰è¡¨æƒ…ç›¸é—œçš„ class
                oguriContainer.classList.remove('happy', 'sad');

                if(mood === 'happy') {
                    // å¦‚æœæ‚¨æœ‰ oguri_happy.png, è«‹å°‡ä¸‹æ–¹è¨»è§£å–æ¶ˆ
                    // img.src = 'oguri_happy.png';
                    oguriContainer.classList.add('happy');
                } else if(mood === 'sad') {
                    // å¦‚æœæ‚¨æœ‰ oguri_sad.png, è«‹å°‡ä¸‹æ–¹è¨»è§£å–æ¶ˆ
                    // img.src = 'oguri_sad.png';
                    oguriContainer.classList.add('sad');
                }
                
                // å»¶é²ä¸€æ®µæ™‚é–“å¾Œæ¢å¾©æ­£å¸¸åœ–ç‰‡å’Œç‹€æ…‹
                setTimeout(() => {
                    if (this.isPlaying) { 
                        img.src = 'oguri_normal.png'; // æ¢å¾©åˆ°æ‚¨æä¾›çš„é è¨­åœ–ç‰‡
                        oguriContainer.classList.remove('happy', 'sad');
                    }
                }, 600); // 0.6 ç§’å¾Œæ¢å¾©
            },

            // é€£æ“Šç‰¹æ•ˆ
            showComboAnim: function() {
                if (this.combo < 2) return;
                const el = this.elements.comboText;
                el.innerText = this.combo + " é€£æ“Š!";
                el.style.animation = 'none';
                el.offsetHeight; /* trigger reflow */
                el.style.animation = 'popUp 0.6s ease-out';
            },

            // æ›´æ–°ä»‹é¢æ–‡å­—
            updateUI: function() {
                this.elements.timerDisplay.innerText = this.timeLeft;
                this.elements.scoreDisplay.innerText = this.score;
            },

            // éŠæˆ²çµæŸ
            end: function() {
                this.isPlaying = false;
                clearInterval(this.timerInterval);
                
                this.elements.finalScore.innerText = this.score;
                
                let comment = "";
                if (this.score < 100) comment = "å°æ —å¸½é‚„æ²’åƒé£½å‘¢...";
                else if (this.score < 300) comment = "ä¸éŒ¯ï¼å°æ —å¸½å¾ˆé–‹å¿ƒï¼";
                else if (this.score < 500) comment = "å¤ªå²å®³äº†ï¼å¤§èƒƒç‹æ»¿è¶³ï¼";
                else comment = "å‚³èªªä¸­çš„è¨“ç·´å¸«ï¼é€™å°±æ˜¯è˜†æ¯›æ€ªç‰©çš„å¯¦åŠ›ï¼";
                
                this.elements.comment.innerText = comment;
                this.elements.gameOverScreen.classList.remove('hidden');

                // éŠæˆ²çµæŸå¾Œæ¢å¾©åœ–ç‰‡åˆ°é è¨­ç‹€æ…‹
                this.elements.oguriImg.src = 'oguri_normal.png';
                this.elements.oguri.classList.remove('happy', 'sad');
            }
        };

        // å•Ÿå‹•åˆå§‹åŒ–
        game.init();

    </script>
</body>
</html>